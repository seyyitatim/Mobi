@model Mobi.Entities.Product

<!--================Single Product Area =================-->
<div class="product_image_area section_padding">
    <div class="container">
        <div class="row s_product_inner justify-content-between">
            <div class="col-lg-7 col-xl-7">
                <div class="product_slider_img">
                    <div id="vertical">
                        <div data-thumb="/image/products/@Model.OriginalImagePath">
                            <img src="/image/products/@Model.OriginalImagePath" style="width:100%;" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-xl-4">
                <div class="s_product_text" style="padding-top:150px;">
                    <h3>@Model.Name</h3>
                    <ul class="list">
                        <li>
                            <a class="active" href="#">
                                <span>Kategori</span> : @Model.Category.Name
                            </a>
                        </li>
                    </ul>
                    <div id="favorite" class="card_area d-flex justify-content-between align-items-center">
                        @if (!User.Identity.IsAuthenticated)
                        {
                            <p>Favorilere eklemek için lütfen üye olunuz ya da giriş yapınız!</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--================End Single Product Area =================-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
@if (User.Identity.IsAuthenticated)
{
    <script>
        var favoriteElement = document.getElementById("favorite");
        var ProductId = @Model.Id;
        var UserId = @UserManager.GetUserAsync(User).Result.Id;

        checkFavorite(ProductId,UserId);

        function checkFavorite(productId, userId){
            $.get(`/api/CheckFavorite?productId=${productId}&userId=${userId}`,  // url
                function (data, textStatus, jqXHR) {  // success callback
                    favoriteElement.innerHTML = '';
                    if(data){
                        favoriteElement.innerHTML = `<a href="#" onclick="deleteFavorite(${productId},${userId})" class="btn_3">Favorilereden Çıkar</a>`
                    }
                    else{
                        favoriteElement.innerHTML = `<a href="#" onclick="addFavorite(${productId},${userId})" class="btn_3">Favorilere Ekle</a>`
                    }
            });
        }

        function addFavorite(productId, userId){
            $.get(`/api/AddFavorite?productId=${productId}&userId=${userId}`,  // url
                function (data, textStatus, jqXHR) {  // success callback
                    checkFavorite(ProductId,UserId);
            });
        }

        function deleteFavorite(productId, userId){
            $.get(`/api/DeleteFavorite?productId=${productId}&userId=${userId}`,  // url
                function (data, textStatus, jqXHR) {  // success callback
                    checkFavorite(ProductId,UserId);
            });
        }
    </script>
}